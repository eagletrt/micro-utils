# Internal data

Inside the library there are multiple arrays and structures used to hold all the data
needed to manage the errors.

Two arrays are used to save the **total number of instances** and the **timeouts** of the errors
which are related to a single group of errors rather than an error instance itself.

Then one array for each error group is declared, in which the data of the single error instance
is stored; the length of the array depends on the number of instances of the corresponding group.

Another array is used to easily access all the others from within the library.

Each error instance contains the following information:

- `group`: the group to which the error belongs (used for a faster lookup)
- `timestamp`: the time in which the error was set
- `is_running`: a flag that, if set to true, means that the error is set
- `is_expired`: a flag that, if set to true, means that the error is expired

!!! note
    An expired error cannot be set or reset again as it remains in the expired state
    until the entire system is restored to its initial state

---

A total of two [ring buffers](https://github.com/eagletrt/micro-libs/tree/master/ring-buffer) and
a [min heap](https://github.com/eagletrt/micro-libs/tree/master/min-heap) are used to keep
track of the running and expired errors as well as to manage all the operations.

The first buffer is used to store the data given when an operation is performed
from user code, this is due to problems generated by interrupts.

The error data stored inside the buffer are:

- `group`: the group to which the error belongs
- `instance`: the instance of the error
- `timestamp`: the current time
- `op`: a pointer to a function which is the operation that should be performed on the error

The second buffer is used to store pointers to the already expired errors, this is mainly used
to gather information about them faster without a full search, which might be too computationally expensive.

The min heap is used to store all the errors that are currently set but still have to expire;
the usage of a heap instead of a simple buffer is required by the fact that the errors have
to be sorted by their elapse time.

Other two arrays are used to store the current number of running and expired errors for
each group.

